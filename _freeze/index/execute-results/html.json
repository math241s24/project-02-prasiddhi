{
  "hash": "f36954854808815ed8016965e2237af8",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Comparing Coffee Characteristics by Country of Origin\"\nsubtitle: \"Project 2\"\nauthor: \"Prasiddhi Thapaliya\"\nformat: html\neditor: visual\nexecute:\n  echo: false\n  warning: false\n  message: false\n---\n\n\n## Introduction\n\nThere are many ways to tell how good a cup of coffee is– from the way it smells, to the way it tastes, even from its color and how well it combines with milk to form a latte. As someone who considers themselves a coffee connoisseur, I decided to combine my love of caffeine with a few of the concepts we've learned in class.\n\nFor my second project, I explored data from a coffee reviews data set. This data set contains consumer reviews from the Coffee Quality Institute, an organization that has information on hundreds of types of coffees grown around the world. The data set comprises information from customers who have tasted coffees and rated them on various categories, such as acidity and sweetness. The quality measures were standardized and converted to a 1-10 numeric scale, with a 1-100 scale for \"Total Cup Points\". It also has information on the coffee itself, such as country of origin and bean processing methods. This data was scraped and cleaned by GitHub user @jldbc. I used three csv files: one for the arabica species, one for robusta, and one merging both. The dimensions of the datasets all have 44 columns. The orginal arabica dataset has 1311 rows, the robusta dataset has 28 rows, and the merged dataset has 1339 rows.\n\nHere is a look at the column names:\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"...1\"                  \"Species\"               \"Owner\"                \n [4] \"Country of Origin\"     \"Farm.Name\"             \"Lot.Number\"           \n [7] \"Mill\"                  \"ICO.Number\"            \"Company\"              \n[10] \"Altitude\"              \"Region\"                \"Producer\"             \n[13] \"Number.of.Bags\"        \"Bag.Weight\"            \"In.Country.Partner\"   \n[16] \"Harvest.Year\"          \"Grading.Date\"          \"Owner.1\"              \n[19] \"Variety\"               \"Processing.Method\"     \"Aroma\"                \n[22] \"Flavor\"                \"Aftertaste\"            \"Acidity\"              \n[25] \"Body\"                  \"Balance\"               \"Uniformity\"           \n[28] \"Clean.Cup\"             \"Sweetness\"             \"Cupper.Points\"        \n[31] \"Total Cup Points\"      \"Moisture\"              \"Category.One.Defects\" \n[34] \"Quakers\"               \"Color\"                 \"Category.Two.Defects\" \n[37] \"Expiration\"            \"Certification.Body\"    \"Certification.Address\"\n[40] \"Certification.Contact\" \"unit_of_measurement\"   \"altitude_low_meters\"  \n[43] \"altitude_high_meters\"  \"altitude_mean_meters\" \n```\n\n\n:::\n:::\n\n\nAfter looking through the data, I became curious to see if coffees grown in particular countries or regions produce different flavor profiles. Are African coffees sweeter than South American ones? Does Ethiopia produce more aromatic coffee than Hawaii? My goal was to answer this question and figure out a way to visualize the answer.\n\n## Approach\n\n### Mapping\n\nFirst, I decided to create an interactive chloropleth map in Shinyapp to visualize each trait on a world map. I thought this would be an effective way to visualize the range and variability across the world, while highlighting the areas with particularly high or low ratings of each flavor quality.\n\nTo do this, I looked at coffee rating on five flavor traits: acidity, aroma, flavor, sweetness, and Total Cup Points (aka an overall rating). I took an average for each country of all the coffees it produces and assigned it that mean value for the corresponding category.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 37 × 6\n   `Country of Origin` Acidity Aroma Flavor Sweetness `Total Cup Points`\n   <chr>                 <dbl> <dbl>  <dbl>     <dbl>              <dbl>\n 1 Brazil                 7.51  7.55   7.57      9.95               82.4\n 2 Burundi                7.42  7.42   7.46     10                  81.8\n 3 China                  7.58  7.64   7.63      9.92               82.9\n 4 Colombia               7.56  7.65   7.60      9.95               83.1\n 5 Costa Rica             7.57  7.67   7.54      9.91               82.8\n 6 Cote d?Ivoire          7     7.42   7.25     10                  79.3\n 7 Ecuador                7.75  7.5    7.67     10                  83.8\n 8 El Salvador            7.59  7.67   7.65      9.81               83.1\n 9 Ethiopia               8.04  7.90   8.01      9.86               85.5\n10 Guatemala              7.60  7.54   7.49      9.87               81.8\n# ℹ 27 more rows\n```\n\n\n:::\n:::\n\n\nThen, I used the tmap package in R to get spatial data for each country in order to map them. From this package, I merged my coffee data sets with the \"World\" data set by country to match each country with its location on a world map. I changed a few of the country names to match and had to leave out Mauritius because it wasn't present in the World data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\narabica_world <- merge(countries, arabica, \n      by.x = \"Country of Origin\", by.y = \"Country of Origin\", \n      all.x = TRUE, all.y = TRUE)\n```\n:::\n\n\nI wanted to be able to see different maps based on type of coffee and flavor category. In the shinyapp, there are two inputs, species and characteristic, to switch between. In total there are ten different maps available. The countries are labeled by their three letter acronyms, and when you hover over a shaded country its mean value appears for that category. Here is the code for the UI:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nui <- fluidPage(\n    titlePanel(\"Coffee by Country\"),\n    tmapOutput(\"map\"),\n    selectInput(\"var\", \"Characteristic\", arabica_vars),\n    selectInput(\"species\", \"Species\", choices = species_names)\n  )\n```\n:::\n\n\nAnd here is a snippet of the code for the server to change the map based on the two inputs:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nobserve({\n      var <- input$var\n      species_name <- input$species\n      \n      species_label <- switch(species_name,\n                              \"Arabica\" = \"arabica_world\",\n                              \"Robusta\" = \"robusta_world\",\n                              \"Both\" = \"both_world\")\n      \n      dataset <- get(species_label)\n      \n      tmapProxy(\"map\", session, {\n        tm_remove_layer(401) +\n          tm_shape(dataset) +\n          tm_polygons(title = paste(var, \"(\",species_name,\")\"), var, zindex = 401, palette = coffee_palette, id = input$var) +\n          tm_text(\"iso_a3\", size = 0.4, just = \"center\")\n      })\n```\n:::\n\n\nTo see the interactive map, open the shinyApps folder in the project files and go to the shinymap.R file!\n\n### Predictive Modelling\n\nFor further analysis, I wanted to explore how strong the correlation is between country of origin and flavor categories. I decided to use supervised learning predictive modelling to see if it's possible to predict origin of a coffee based on its flavor profile. To simplify, I assigned each country its continent so instead of predicting exact nation, the model can predict a region. All of the observations were located in North America, South America, Asia, and Africa with the exception of Papua New Guinea in Oceania. Therefore, I removed it from the modelling data because it wouldn't make sense to have the model predict based on a single observation, since it also produced only one coffee.\n\nFirst, I used a decision tree model. I used the following formula:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nform_all <- as.formula(\n  \"continent ~ Sweetness + Acidity + Total + Flavor + Aroma + Species\"\n  )\n```\n:::\n\n\nI split the data into training and test. For the decision tree, my accuracy is around 50-55%. Next, I used a randomForest model using the same formula as above. This was super accurate on my training data (98% accurate) but not so much on test data (48-50%), indicating the model was very overfit for the training data. I played around with the mtry and trees argument but didn't have much luck on improving this.\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\nI also made a shinyApp where users can input values for the five categories and the model will predict which continent the coffee originates from. In full disclosure, there is an error I wasn't able to fix which seemingly only predicts Africa or Asia. To view this, go to the shinyApps folder and see shinymodel.R!\n\n## Discussion of Results\n\nFrom the map, it seems that Africa and South America produce coffees with the most distinct flavor profiles. That is, these regions tend to be darker on the map for most of the flavor categories. For total cup points, Ethiopia, Kenya, Uganda, and Papua New Guinea have the darkest shading, indicating they produce the \"best\" coffee according to these consumer reviews.\n\nThe data may not be entirely representative though; North and South America have the most observations and these are concentrated in specific countries. The data could be underrepresenting Asia. Additionally, since I used mean values for the maps, this means my data is more sensitive to outliers. The robusta species also has much fewer observations, so it may be underrepresented in comparison to Arabica.\n\nThe predictive modelling was not very accurate for the chosen data and variables. North and South America are the most common observations and so the model tends to default to these continents, misclassifying Africa and Asia.\n\nHere is the accuracy and confusion matrix for the decision tree: \n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 3\n  .metric  .estimator .estimate\n  <chr>    <chr>          <dbl>\n1 accuracy multiclass     0.559\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n               Truth\nPrediction      Africa Asia North America South America\n  Africa             6    6             0             1\n  Asia               0    0             0             0\n  North America     97  105           467           138\n  South America     28   26            70           125\n```\n\n\n:::\n:::\n\n\nAnd for the randomForest model using training data:\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n               Truth\nPrediction      Africa Asia North America South America\n  Africa           130    0             1             0\n  Asia               0  130             0             0\n  North America      1    4           531             5\n  South America      0    3             5           259\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 3\n  .metric  .estimator .estimate\n  <chr>    <chr>          <dbl>\n1 accuracy multiclass     0.982\n```\n\n\n:::\n:::\n\n\nAnd for randomForest, using test data:\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n               Truth\nPrediction      Africa Asia North America South America\n  Africa             8    4             6             3\n  Asia               3    8            13             9\n  North America     12   17            89            33\n  South America      8   16            20            19\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 3\n  .metric  .estimator .estimate\n  <chr>    <chr>          <dbl>\n1 accuracy multiclass     0.463\n```\n\n\n:::\n:::\n\nThis list shows which variables are most relevant in predicting continent.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 2\n  variable  MeanDecreaseGini\n  <chr>                <dbl>\n1 Total               249.  \n2 Aroma               144.  \n3 Acidity             137.  \n4 Flavor              126.  \n5 Sweetness            21.9 \n6 Species               9.52\n```\n\n\n:::\n:::\n\n\nTotal Points, Aroma, Acidity, and Flavor are the most important indicators for predicting origin, while Sweetness and Species are relatively unimportant. \n\nIn conclusion, it may be that flavor and origin are not as closely related as I thought. Or, it could be that my chosen models are not able to demonstrate this relationship, and I would need to tune it accordingly to better represent the association. For future analysis, I could try and see if other indicators such as altitude or bean processing method are correlated with flavor profiles of coffee.\n\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}